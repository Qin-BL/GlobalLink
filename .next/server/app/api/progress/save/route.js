"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/progress/save/route";
exports.ids = ["app/api/progress/save/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fprogress%2Fsave%2Froute&page=%2Fapi%2Fprogress%2Fsave%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprogress%2Fsave%2Froute.ts&appDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fprogress%2Fsave%2Froute&page=%2Fapi%2Fprogress%2Fsave%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprogress%2Fsave%2Froute.ts&appDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_Zhuanz_Desktop_Cache_next_english_app_sm2_app_api_progress_save_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/progress/save/route.ts */ \"(rsc)/./app/api/progress/save/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/progress/save/route\",\n        pathname: \"/api/progress/save\",\n        filename: \"route\",\n        bundlePath: \"app/api/progress/save/route\"\n    },\n    resolvedPagePath: \"/Users/Zhuanz/Desktop/Cache/next-english-app-sm2/app/api/progress/save/route.ts\",\n    nextConfigOutput,\n    userland: _Users_Zhuanz_Desktop_Cache_next_english_app_sm2_app_api_progress_save_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/progress/save/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwcm9ncmVzcyUyRnNhdmUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnByb2dyZXNzJTJGc2F2ZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnByb2dyZXNzJTJGc2F2ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRlpodWFueiUyRkRlc2t0b3AlMkZDYWNoZSUyRm5leHQtZW5nbGlzaC1hcHAtc20yJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRlpodWFueiUyRkRlc2t0b3AlMkZDYWNoZSUyRm5leHQtZW5nbGlzaC1hcHAtc20yJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMrQjtBQUM1RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL25leHQtZW5nbGlzaC1hcHAtc20yLz81YmEwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9aaHVhbnovRGVza3RvcC9DYWNoZS9uZXh0LWVuZ2xpc2gtYXBwLXNtMi9hcHAvYXBpL3Byb2dyZXNzL3NhdmUvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Byb2dyZXNzL3NhdmUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9wcm9ncmVzcy9zYXZlXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9wcm9ncmVzcy9zYXZlL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL1podWFuei9EZXNrdG9wL0NhY2hlL25leHQtZW5nbGlzaC1hcHAtc20yL2FwcC9hcGkvcHJvZ3Jlc3Mvc2F2ZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcHJvZ3Jlc3Mvc2F2ZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fprogress%2Fsave%2Froute&page=%2Fapi%2Fprogress%2Fsave%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprogress%2Fsave%2Froute.ts&appDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/progress/save/route.ts":
/*!****************************************!*\
  !*** ./app/api/progress/save/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n// app/api/progress/save/route.ts - 学习进度保存 API（基于 SM2 算法）\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"english-sm2-secret-key\";\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { wordId, word, isCorrect, quality, sessionType = \"practice\" } = body;\n        // 验证用户身份\n        const userId = await getUserIdFromToken(request);\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                message: \"用户未登录\"\n            }, {\n                status: 401\n            });\n        }\n        // 输入验证\n        if (!wordId || !word || quality === undefined) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                message: \"缺少必要参数：wordId, word, quality\"\n            }, {\n                status: 400\n            });\n        }\n        // 验证 quality 范围 (0-5)\n        if (quality < 0 || quality > 5) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                message: \"quality 参数必须在 0-5 之间\"\n            }, {\n                status: 400\n            });\n        }\n        // 获取用户学习进度数据\n        const userProgress = getUserProgress(userId);\n        // 获取或创建单词进度\n        let wordProgress = userProgress.wordsProgress.get(wordId);\n        if (!wordProgress) {\n            // 新单词，初始化 SM2 数据\n            wordProgress = createNewWordProgress(wordId, word);\n        }\n        // 使用 SM2 算法更新学习数据\n        const updatedSM2Data = calculateSM2(wordProgress.sm2Data, quality);\n        // 更新单词进度\n        wordProgress.sm2Data = updatedSM2Data;\n        wordProgress.totalReviews++;\n        if (isCorrect) {\n            wordProgress.correctReviews++;\n        }\n        wordProgress.lastReviewDate = new Date().toISOString();\n        wordProgress.updatedAt = new Date().toISOString();\n        // 更新掌握程度\n        wordProgress.masteryLevel = calculateMasteryLevel(wordProgress);\n        // 保存单词进度\n        userProgress.wordsProgress.set(wordId, wordProgress);\n        // 更新用户总体统计\n        updateUserStats(userProgress, isCorrect, sessionType);\n        // 记录学习会话\n        await recordStudySession(userId, {\n            wordId,\n            word,\n            isCorrect,\n            quality,\n            sessionType,\n            studyTime: 1 // 假设每个单词学习时间为1分钟\n        });\n        // 返回更新后的进度数据\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            wordProgress: {\n                wordId: wordProgress.wordId,\n                word: wordProgress.word,\n                masteryLevel: wordProgress.masteryLevel,\n                nextReviewDate: wordProgress.sm2Data.nextReviewDate,\n                interval: wordProgress.sm2Data.interval,\n                totalReviews: wordProgress.totalReviews,\n                accuracy: Math.round(wordProgress.correctReviews / wordProgress.totalReviews * 100)\n            },\n            userStats: {\n                totalWordsLearned: userProgress.totalWordsLearned,\n                totalStudyTime: userProgress.totalStudyTime,\n                streakDays: userProgress.streakDays,\n                currentLevel: userProgress.currentLevel\n            }\n        });\n    } catch (error) {\n        console.error(\"学习进度保存 API 错误:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: \"保存学习进度失败\"\n        }, {\n            status: 500\n        });\n    }\n}\n// 获取用户学习进度\nasync function GET(request) {\n    try {\n        const userId = await getUserIdFromToken(request);\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                message: \"用户未登录\"\n            }, {\n                status: 401\n            });\n        }\n        const searchParams = request.nextUrl.searchParams;\n        const wordId = searchParams.get(\"wordId\");\n        const userProgress = getUserProgress(userId);\n        if (wordId) {\n            // 获取特定单词的进度\n            const wordProgress = userProgress.wordsProgress.get(wordId);\n            if (!wordProgress) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    message: \"单词进度不存在\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                wordProgress\n            });\n        } else {\n            // 获取用户总体进度\n            const wordsArray = Array.from(userProgress.wordsProgress.values());\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                userStats: {\n                    totalWordsLearned: userProgress.totalWordsLearned,\n                    totalStudyTime: userProgress.totalStudyTime,\n                    streakDays: userProgress.streakDays,\n                    currentLevel: userProgress.currentLevel,\n                    dailyGoal: userProgress.dailyGoal\n                },\n                wordsProgress: wordsArray,\n                recentActivity: await getRecentActivity(userId)\n            });\n        }\n    } catch (error) {\n        console.error(\"获取学习进度 API 错误:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: \"获取学习进度失败\"\n        }, {\n            status: 500\n        });\n    }\n}\n// 从 token 获取用户 ID\nasync function getUserIdFromToken(request) {\n    try {\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            return null;\n        }\n        const token = authHeader.substring(7);\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n        return decoded.userId;\n    } catch (error) {\n        return null;\n    }\n}\n// 获取用户进度数据\nfunction getUserProgress(userId) {\n    global.userProgress = global.userProgress || new Map();\n    if (!global.userProgress.has(userId)) {\n        // 初始化用户进度数据\n        global.userProgress.set(userId, {\n            currentLevel: 1,\n            totalWordsLearned: 0,\n            totalStudyTime: 0,\n            streakDays: 0,\n            lastStudyDate: null,\n            wordsProgress: new Map(),\n            dailyGoal: 20,\n            weeklyStats: [],\n            monthlyStats: []\n        });\n    }\n    return global.userProgress.get(userId);\n}\n// 创建新单词进度\nfunction createNewWordProgress(wordId, word) {\n    const now = new Date().toISOString();\n    return {\n        wordId,\n        word,\n        sm2Data: {\n            easinessFactor: 2.5,\n            repetitions: 0,\n            interval: 1,\n            nextReviewDate: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),\n            quality: 0\n        },\n        totalReviews: 0,\n        correctReviews: 0,\n        lastReviewDate: now,\n        masteryLevel: \"new\",\n        createdAt: now,\n        updatedAt: now\n    };\n}\n// SM2 算法计算\nfunction calculateSM2(currentSM2, quality) {\n    let { easinessFactor, repetitions, interval } = currentSM2;\n    if (quality >= 3) {\n        // 答对了\n        if (repetitions === 0) {\n            interval = 1;\n        } else if (repetitions === 1) {\n            interval = 6;\n        } else {\n            interval = Math.round(interval * easinessFactor);\n        }\n        repetitions++;\n    } else {\n        // 答错了，重置\n        repetitions = 0;\n        interval = 1;\n    }\n    // 更新难度因子\n    easinessFactor = easinessFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));\n    // 限制难度因子范围\n    if (easinessFactor < 1.3) {\n        easinessFactor = 1.3;\n    }\n    // 计算下次复习日期\n    const nextReviewDate = new Date(Date.now() + interval * 24 * 60 * 60 * 1000).toISOString();\n    return {\n        easinessFactor,\n        repetitions,\n        interval,\n        nextReviewDate,\n        quality\n    };\n}\n// 计算掌握程度\nfunction calculateMasteryLevel(wordProgress) {\n    const { totalReviews, correctReviews, sm2Data } = wordProgress;\n    if (totalReviews === 0) {\n        return \"new\";\n    }\n    const accuracy = correctReviews / totalReviews;\n    if (sm2Data.repetitions >= 3 && accuracy >= 0.8 && sm2Data.interval >= 7) {\n        return \"mastered\";\n    } else if (totalReviews >= 1) {\n        return \"learning\";\n    }\n    return \"new\";\n}\n// 更新用户统计\nfunction updateUserStats(userProgress, isCorrect, sessionType) {\n    // 更新总学习时间\n    userProgress.totalStudyTime += 1 // 每个单词1分钟\n    ;\n    // 更新学习天数连续性\n    const today = new Date().toDateString();\n    if (userProgress.lastStudyDate !== today) {\n        const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString();\n        if (userProgress.lastStudyDate === yesterday) {\n            userProgress.streakDays++;\n        } else {\n            userProgress.streakDays = 1;\n        }\n        userProgress.lastStudyDate = today;\n    }\n    // 更新总学习单词数\n    userProgress.totalWordsLearned = userProgress.wordsProgress.size;\n    // 更新等级（每100个单词升一级）\n    userProgress.currentLevel = Math.floor(userProgress.totalWordsLearned / 100) + 1;\n}\n// 记录学习会话\nasync function recordStudySession(userId, sessionData) {\n    try {\n        global.studySessions = global.studySessions || [];\n        const session = {\n            sessionId: `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n            userId,\n            timestamp: new Date().toISOString(),\n            ...sessionData\n        };\n        global.studySessions.push(session);\n        // 只保留最近1000条会话记录\n        if (global.studySessions.length > 1000) {\n            global.studySessions = global.studySessions.slice(-1000);\n        }\n    } catch (error) {\n        console.error(\"记录学习会话失败:\", error);\n    }\n}\n// 获取最近活动\nasync function getRecentActivity(userId) {\n    try {\n        const sessions = global.studySessions || [];\n        const userSessions = sessions.filter((session)=>session.userId === userId).slice(-10) // 最近10条记录\n        .reverse();\n        return userSessions;\n    } catch (error) {\n        console.error(\"获取最近活动失败:\", error);\n        return [];\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q1QsZUFBZVQsbUJBQW1CeEIsTUFBYyxFQUFFd0UsV0FBZ0I7SUFDaEUsSUFBSTtRQUNGaEIsT0FBT2lCLGFBQWEsR0FBR2pCLE9BQU9pQixhQUFhLElBQUksRUFBRTtRQUVqRCxNQUFNQyxVQUFVO1lBQ2RDLFdBQVcsQ0FBQyxRQUFRLEVBQUUxRCxLQUFLNkMsR0FBRyxHQUFHLENBQUMsRUFBRWhDLEtBQUs4QyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDN0U5RTtZQUNBK0UsV0FBVyxJQUFJOUQsT0FBT0MsV0FBVztZQUNqQyxHQUFHc0QsV0FBVztRQUNoQjtRQUVBaEIsT0FBT2lCLGFBQWEsQ0FBQ08sSUFBSSxDQUFDTjtRQUUxQixpQkFBaUI7UUFDakIsSUFBSWxCLE9BQU9pQixhQUFhLENBQUNRLE1BQU0sR0FBRyxNQUFNO1lBQ3RDekIsT0FBT2lCLGFBQWEsR0FBR2pCLE9BQU9pQixhQUFhLENBQUNTLEtBQUssQ0FBQyxDQUFDO1FBQ3JEO0lBQ0YsRUFBRSxPQUFPN0MsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsYUFBYUE7SUFDN0I7QUFDRjtBQUVBLFNBQVM7QUFDVCxlQUFlVyxrQkFBa0JoRCxNQUFjO0lBQzdDLElBQUk7UUFDRixNQUFNbUYsV0FBVzNCLE9BQU9pQixhQUFhLElBQUksRUFBRTtRQUMzQyxNQUFNVyxlQUFlRCxTQUNsQkUsTUFBTSxDQUFDLENBQUNYLFVBQWlCQSxRQUFRMUUsTUFBTSxLQUFLQSxRQUM1Q2tGLEtBQUssQ0FBQyxDQUFDLElBQUksVUFBVTtTQUNyQkksT0FBTztRQUVWLE9BQU9GO0lBQ1QsRUFBRSxPQUFPL0MsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsYUFBYUE7UUFDM0IsT0FBTyxFQUFFO0lBQ1g7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25leHQtZW5nbGlzaC1hcHAtc20yLy4vYXBwL2FwaS9wcm9ncmVzcy9zYXZlL3JvdXRlLnRzPzNlNzUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwL2FwaS9wcm9ncmVzcy9zYXZlL3JvdXRlLnRzIC0g5a2m5Lmg6L+b5bqm5L+d5a2YIEFQSe+8iOWfuuS6jiBTTTIg566X5rOV77yJXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbidcblxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ2VuZ2xpc2gtc20yLXNlY3JldC1rZXknXG5cbi8vIFNNMiDnrpfms5Xnm7jlhbPmjqXlj6NcbmludGVyZmFjZSBTTTJEYXRhIHtcbiAgZWFzaW5lc3NGYWN0b3I6IG51bWJlciAvLyDpmr7luqblm6DlrZAgKDEuMyAtIDIuNSlcbiAgcmVwZXRpdGlvbnM6IG51bWJlciAgICAvLyDph43lpI3mrKHmlbBcbiAgaW50ZXJ2YWw6IG51bWJlciAgICAgICAvLyDpl7TpmpTlpKnmlbBcbiAgbmV4dFJldmlld0RhdGU6IHN0cmluZyAvLyDkuIvmrKHlpI3kuaDml6XmnJ9cbiAgcXVhbGl0eTogbnVtYmVyICAgICAgICAvLyDmnIDlkI7kuIDmrKHnrZTpopjotKjph48gKDAtNSlcbn1cblxuaW50ZXJmYWNlIFdvcmRQcm9ncmVzcyB7XG4gIHdvcmRJZDogc3RyaW5nXG4gIHdvcmQ6IHN0cmluZ1xuICBzbTJEYXRhOiBTTTJEYXRhXG4gIHRvdGFsUmV2aWV3czogbnVtYmVyXG4gIGNvcnJlY3RSZXZpZXdzOiBudW1iZXJcbiAgbGFzdFJldmlld0RhdGU6IHN0cmluZ1xuICBtYXN0ZXJ5TGV2ZWw6ICduZXcnIHwgJ2xlYXJuaW5nJyB8ICdtYXN0ZXJlZCdcbiAgY3JlYXRlZEF0OiBzdHJpbmdcbiAgdXBkYXRlZEF0OiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFN0dWR5U2Vzc2lvbiB7XG4gIHNlc3Npb25JZDogc3RyaW5nXG4gIHVzZXJJZDogc3RyaW5nXG4gIHN0YXJ0VGltZTogc3RyaW5nXG4gIGVuZFRpbWU/OiBzdHJpbmdcbiAgd29yZHNTdHVkaWVkOiBzdHJpbmdbXVxuICBjb3JyZWN0QW5zd2VyczogbnVtYmVyXG4gIHRvdGFsQW5zd2VyczogbnVtYmVyXG4gIHN0dWR5VGltZU1pbnV0ZXM6IG51bWJlclxuICBzZXNzaW9uVHlwZTogJ25ld193b3JkcycgfCAncmV2aWV3JyB8ICdwcmFjdGljZSdcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IHdvcmRJZCwgd29yZCwgaXNDb3JyZWN0LCBxdWFsaXR5LCBzZXNzaW9uVHlwZSA9ICdwcmFjdGljZScgfSA9IGJvZHlcblxuICAgIC8vIOmqjOivgeeUqOaIt+i6q+S7vVxuICAgIGNvbnN0IHVzZXJJZCA9IGF3YWl0IGdldFVzZXJJZEZyb21Ub2tlbihyZXF1ZXN0KVxuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogJ+eUqOaIt+acqueZu+W9lScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g6L6T5YWl6aqM6K+BXG4gICAgaWYgKCF3b3JkSWQgfHwgIXdvcmQgfHwgcXVhbGl0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogJ+e8uuWwkeW/heimgeWPguaVsO+8mndvcmRJZCwgd29yZCwgcXVhbGl0eScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g6aqM6K+BIHF1YWxpdHkg6IyD5Zu0ICgwLTUpXG4gICAgaWYgKHF1YWxpdHkgPCAwIHx8IHF1YWxpdHkgPiA1KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogJ3F1YWxpdHkg5Y+C5pWw5b+F6aG75ZyoIDAtNSDkuYvpl7QnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIOiOt+WPlueUqOaIt+WtpuS5oOi/m+W6puaVsOaNrlxuICAgIGNvbnN0IHVzZXJQcm9ncmVzcyA9IGdldFVzZXJQcm9ncmVzcyh1c2VySWQpXG4gICAgXG4gICAgLy8g6I635Y+W5oiW5Yib5bu65Y2V6K+N6L+b5bqmXG4gICAgbGV0IHdvcmRQcm9ncmVzcyA9IHVzZXJQcm9ncmVzcy53b3Jkc1Byb2dyZXNzLmdldCh3b3JkSWQpXG4gICAgXG4gICAgaWYgKCF3b3JkUHJvZ3Jlc3MpIHtcbiAgICAgIC8vIOaWsOWNleivje+8jOWIneWni+WMliBTTTIg5pWw5o2uXG4gICAgICB3b3JkUHJvZ3Jlc3MgPSBjcmVhdGVOZXdXb3JkUHJvZ3Jlc3Mod29yZElkLCB3b3JkKVxuICAgIH1cblxuICAgIC8vIOS9v+eUqCBTTTIg566X5rOV5pu05paw5a2m5Lmg5pWw5o2uXG4gICAgY29uc3QgdXBkYXRlZFNNMkRhdGEgPSBjYWxjdWxhdGVTTTIod29yZFByb2dyZXNzLnNtMkRhdGEsIHF1YWxpdHkpXG4gICAgXG4gICAgLy8g5pu05paw5Y2V6K+N6L+b5bqmXG4gICAgd29yZFByb2dyZXNzLnNtMkRhdGEgPSB1cGRhdGVkU00yRGF0YVxuICAgIHdvcmRQcm9ncmVzcy50b3RhbFJldmlld3MrK1xuICAgIGlmIChpc0NvcnJlY3QpIHtcbiAgICAgIHdvcmRQcm9ncmVzcy5jb3JyZWN0UmV2aWV3cysrXG4gICAgfVxuICAgIHdvcmRQcm9ncmVzcy5sYXN0UmV2aWV3RGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIHdvcmRQcm9ncmVzcy51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICBcbiAgICAvLyDmm7TmlrDmjozmj6HnqIvluqZcbiAgICB3b3JkUHJvZ3Jlc3MubWFzdGVyeUxldmVsID0gY2FsY3VsYXRlTWFzdGVyeUxldmVsKHdvcmRQcm9ncmVzcylcbiAgICBcbiAgICAvLyDkv53lrZjljZXor43ov5vluqZcbiAgICB1c2VyUHJvZ3Jlc3Mud29yZHNQcm9ncmVzcy5zZXQod29yZElkLCB3b3JkUHJvZ3Jlc3MpXG4gICAgXG4gICAgLy8g5pu05paw55So5oi35oC75L2T57uf6K6hXG4gICAgdXBkYXRlVXNlclN0YXRzKHVzZXJQcm9ncmVzcywgaXNDb3JyZWN0LCBzZXNzaW9uVHlwZSlcbiAgICBcbiAgICAvLyDorrDlvZXlrabkuaDkvJror51cbiAgICBhd2FpdCByZWNvcmRTdHVkeVNlc3Npb24odXNlcklkLCB7XG4gICAgICB3b3JkSWQsXG4gICAgICB3b3JkLFxuICAgICAgaXNDb3JyZWN0LFxuICAgICAgcXVhbGl0eSxcbiAgICAgIHNlc3Npb25UeXBlLFxuICAgICAgc3R1ZHlUaW1lOiAxIC8vIOWBh+iuvuavj+S4quWNleivjeWtpuS5oOaXtumXtOS4ujHliIbpkp9cbiAgICB9KVxuXG4gICAgLy8g6L+U5Zue5pu05paw5ZCO55qE6L+b5bqm5pWw5o2uXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB3b3JkUHJvZ3Jlc3M6IHtcbiAgICAgICAgd29yZElkOiB3b3JkUHJvZ3Jlc3Mud29yZElkLFxuICAgICAgICB3b3JkOiB3b3JkUHJvZ3Jlc3Mud29yZCxcbiAgICAgICAgbWFzdGVyeUxldmVsOiB3b3JkUHJvZ3Jlc3MubWFzdGVyeUxldmVsLFxuICAgICAgICBuZXh0UmV2aWV3RGF0ZTogd29yZFByb2dyZXNzLnNtMkRhdGEubmV4dFJldmlld0RhdGUsXG4gICAgICAgIGludGVydmFsOiB3b3JkUHJvZ3Jlc3Muc20yRGF0YS5pbnRlcnZhbCxcbiAgICAgICAgdG90YWxSZXZpZXdzOiB3b3JkUHJvZ3Jlc3MudG90YWxSZXZpZXdzLFxuICAgICAgICBhY2N1cmFjeTogTWF0aC5yb3VuZCgod29yZFByb2dyZXNzLmNvcnJlY3RSZXZpZXdzIC8gd29yZFByb2dyZXNzLnRvdGFsUmV2aWV3cykgKiAxMDApXG4gICAgICB9LFxuICAgICAgdXNlclN0YXRzOiB7XG4gICAgICAgIHRvdGFsV29yZHNMZWFybmVkOiB1c2VyUHJvZ3Jlc3MudG90YWxXb3Jkc0xlYXJuZWQsXG4gICAgICAgIHRvdGFsU3R1ZHlUaW1lOiB1c2VyUHJvZ3Jlc3MudG90YWxTdHVkeVRpbWUsXG4gICAgICAgIHN0cmVha0RheXM6IHVzZXJQcm9ncmVzcy5zdHJlYWtEYXlzLFxuICAgICAgICBjdXJyZW50TGV2ZWw6IHVzZXJQcm9ncmVzcy5jdXJyZW50TGV2ZWxcbiAgICAgIH1cbiAgICB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign5a2m5Lmg6L+b5bqm5L+d5a2YIEFQSSDplJnor686JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBtZXNzYWdlOiAn5L+d5a2Y5a2m5Lmg6L+b5bqm5aSx6LSlJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbi8vIOiOt+WPlueUqOaIt+WtpuS5oOi/m+W6plxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IGF3YWl0IGdldFVzZXJJZEZyb21Ub2tlbihyZXF1ZXN0KVxuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogJ+eUqOaIt+acqueZu+W9lScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gcmVxdWVzdC5uZXh0VXJsLnNlYXJjaFBhcmFtc1xuICAgIGNvbnN0IHdvcmRJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3dvcmRJZCcpXG4gICAgXG4gICAgY29uc3QgdXNlclByb2dyZXNzID0gZ2V0VXNlclByb2dyZXNzKHVzZXJJZClcbiAgICBcbiAgICBpZiAod29yZElkKSB7XG4gICAgICAvLyDojrflj5bnibnlrprljZXor43nmoTov5vluqZcbiAgICAgIGNvbnN0IHdvcmRQcm9ncmVzcyA9IHVzZXJQcm9ncmVzcy53b3Jkc1Byb2dyZXNzLmdldCh3b3JkSWQpXG4gICAgICBpZiAoIXdvcmRQcm9ncmVzcykge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBtZXNzYWdlOiAn5Y2V6K+N6L+b5bqm5LiN5a2Y5ZyoJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHdvcmRQcm9ncmVzc1xuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g6I635Y+W55So5oi35oC75L2T6L+b5bqmXG4gICAgICBjb25zdCB3b3Jkc0FycmF5ID0gQXJyYXkuZnJvbSh1c2VyUHJvZ3Jlc3Mud29yZHNQcm9ncmVzcy52YWx1ZXMoKSlcbiAgICAgIFxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdXNlclN0YXRzOiB7XG4gICAgICAgICAgdG90YWxXb3Jkc0xlYXJuZWQ6IHVzZXJQcm9ncmVzcy50b3RhbFdvcmRzTGVhcm5lZCxcbiAgICAgICAgICB0b3RhbFN0dWR5VGltZTogdXNlclByb2dyZXNzLnRvdGFsU3R1ZHlUaW1lLFxuICAgICAgICAgIHN0cmVha0RheXM6IHVzZXJQcm9ncmVzcy5zdHJlYWtEYXlzLFxuICAgICAgICAgIGN1cnJlbnRMZXZlbDogdXNlclByb2dyZXNzLmN1cnJlbnRMZXZlbCxcbiAgICAgICAgICBkYWlseUdvYWw6IHVzZXJQcm9ncmVzcy5kYWlseUdvYWxcbiAgICAgICAgfSxcbiAgICAgICAgd29yZHNQcm9ncmVzczogd29yZHNBcnJheSxcbiAgICAgICAgcmVjZW50QWN0aXZpdHk6IGF3YWl0IGdldFJlY2VudEFjdGl2aXR5KHVzZXJJZClcbiAgICAgIH0pXG4gICAgfVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign6I635Y+W5a2m5Lmg6L+b5bqmIEFQSSDplJnor686JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBtZXNzYWdlOiAn6I635Y+W5a2m5Lmg6L+b5bqm5aSx6LSlJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbi8vIOS7jiB0b2tlbiDojrflj5bnlKjmiLcgSURcbmFzeW5jIGZ1bmN0aW9uIGdldFVzZXJJZEZyb21Ub2tlbihyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJylcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICBcbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIEpXVF9TRUNSRVQpIGFzIGFueVxuICAgIHJldHVybiBkZWNvZGVkLnVzZXJJZFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuLy8g6I635Y+W55So5oi36L+b5bqm5pWw5o2uXG5mdW5jdGlvbiBnZXRVc2VyUHJvZ3Jlc3ModXNlcklkOiBzdHJpbmcpIHtcbiAgZ2xvYmFsLnVzZXJQcm9ncmVzcyA9IGdsb2JhbC51c2VyUHJvZ3Jlc3MgfHwgbmV3IE1hcCgpXG4gIFxuICBpZiAoIWdsb2JhbC51c2VyUHJvZ3Jlc3MuaGFzKHVzZXJJZCkpIHtcbiAgICAvLyDliJ3lp4vljJbnlKjmiLfov5vluqbmlbDmja5cbiAgICBnbG9iYWwudXNlclByb2dyZXNzLnNldCh1c2VySWQsIHtcbiAgICAgIGN1cnJlbnRMZXZlbDogMSxcbiAgICAgIHRvdGFsV29yZHNMZWFybmVkOiAwLFxuICAgICAgdG90YWxTdHVkeVRpbWU6IDAsXG4gICAgICBzdHJlYWtEYXlzOiAwLFxuICAgICAgbGFzdFN0dWR5RGF0ZTogbnVsbCxcbiAgICAgIHdvcmRzUHJvZ3Jlc3M6IG5ldyBNYXAoKSxcbiAgICAgIGRhaWx5R29hbDogMjAsXG4gICAgICB3ZWVrbHlTdGF0czogW10sXG4gICAgICBtb250aGx5U3RhdHM6IFtdXG4gICAgfSlcbiAgfVxuICBcbiAgcmV0dXJuIGdsb2JhbC51c2VyUHJvZ3Jlc3MuZ2V0KHVzZXJJZClcbn1cblxuLy8g5Yib5bu65paw5Y2V6K+N6L+b5bqmXG5mdW5jdGlvbiBjcmVhdGVOZXdXb3JkUHJvZ3Jlc3Mod29yZElkOiBzdHJpbmcsIHdvcmQ6IHN0cmluZyk6IFdvcmRQcm9ncmVzcyB7XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICBcbiAgcmV0dXJuIHtcbiAgICB3b3JkSWQsXG4gICAgd29yZCxcbiAgICBzbTJEYXRhOiB7XG4gICAgICBlYXNpbmVzc0ZhY3RvcjogMi41LFxuICAgICAgcmVwZXRpdGlvbnM6IDAsXG4gICAgICBpbnRlcnZhbDogMSxcbiAgICAgIG5leHRSZXZpZXdEYXRlOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSwgLy8g5piO5aSpXG4gICAgICBxdWFsaXR5OiAwXG4gICAgfSxcbiAgICB0b3RhbFJldmlld3M6IDAsXG4gICAgY29ycmVjdFJldmlld3M6IDAsXG4gICAgbGFzdFJldmlld0RhdGU6IG5vdyxcbiAgICBtYXN0ZXJ5TGV2ZWw6ICduZXcnLFxuICAgIGNyZWF0ZWRBdDogbm93LFxuICAgIHVwZGF0ZWRBdDogbm93XG4gIH1cbn1cblxuLy8gU00yIOeul+azleiuoeeul1xuZnVuY3Rpb24gY2FsY3VsYXRlU00yKGN1cnJlbnRTTTI6IFNNMkRhdGEsIHF1YWxpdHk6IG51bWJlcik6IFNNMkRhdGEge1xuICBsZXQgeyBlYXNpbmVzc0ZhY3RvciwgcmVwZXRpdGlvbnMsIGludGVydmFsIH0gPSBjdXJyZW50U00yXG4gIFxuICBpZiAocXVhbGl0eSA+PSAzKSB7XG4gICAgLy8g562U5a+55LqGXG4gICAgaWYgKHJlcGV0aXRpb25zID09PSAwKSB7XG4gICAgICBpbnRlcnZhbCA9IDFcbiAgICB9IGVsc2UgaWYgKHJlcGV0aXRpb25zID09PSAxKSB7XG4gICAgICBpbnRlcnZhbCA9IDZcbiAgICB9IGVsc2Uge1xuICAgICAgaW50ZXJ2YWwgPSBNYXRoLnJvdW5kKGludGVydmFsICogZWFzaW5lc3NGYWN0b3IpXG4gICAgfVxuICAgIHJlcGV0aXRpb25zKytcbiAgfSBlbHNlIHtcbiAgICAvLyDnrZTplJnkuobvvIzph43nva5cbiAgICByZXBldGl0aW9ucyA9IDBcbiAgICBpbnRlcnZhbCA9IDFcbiAgfVxuICBcbiAgLy8g5pu05paw6Zq+5bqm5Zug5a2QXG4gIGVhc2luZXNzRmFjdG9yID0gZWFzaW5lc3NGYWN0b3IgKyAoMC4xIC0gKDUgLSBxdWFsaXR5KSAqICgwLjA4ICsgKDUgLSBxdWFsaXR5KSAqIDAuMDIpKVxuICBcbiAgLy8g6ZmQ5Yi26Zq+5bqm5Zug5a2Q6IyD5Zu0XG4gIGlmIChlYXNpbmVzc0ZhY3RvciA8IDEuMykge1xuICAgIGVhc2luZXNzRmFjdG9yID0gMS4zXG4gIH1cbiAgXG4gIC8vIOiuoeeul+S4i+asoeWkjeS5oOaXpeacn1xuICBjb25zdCBuZXh0UmV2aWV3RGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyBpbnRlcnZhbCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcbiAgXG4gIHJldHVybiB7XG4gICAgZWFzaW5lc3NGYWN0b3IsXG4gICAgcmVwZXRpdGlvbnMsXG4gICAgaW50ZXJ2YWwsXG4gICAgbmV4dFJldmlld0RhdGUsXG4gICAgcXVhbGl0eVxuICB9XG59XG5cbi8vIOiuoeeul+aOjOaPoeeoi+W6plxuZnVuY3Rpb24gY2FsY3VsYXRlTWFzdGVyeUxldmVsKHdvcmRQcm9ncmVzczogV29yZFByb2dyZXNzKTogJ25ldycgfCAnbGVhcm5pbmcnIHwgJ21hc3RlcmVkJyB7XG4gIGNvbnN0IHsgdG90YWxSZXZpZXdzLCBjb3JyZWN0UmV2aWV3cywgc20yRGF0YSB9ID0gd29yZFByb2dyZXNzXG4gIFxuICBpZiAodG90YWxSZXZpZXdzID09PSAwKSB7XG4gICAgcmV0dXJuICduZXcnXG4gIH1cbiAgXG4gIGNvbnN0IGFjY3VyYWN5ID0gY29ycmVjdFJldmlld3MgLyB0b3RhbFJldmlld3NcbiAgXG4gIGlmIChzbTJEYXRhLnJlcGV0aXRpb25zID49IDMgJiYgYWNjdXJhY3kgPj0gMC44ICYmIHNtMkRhdGEuaW50ZXJ2YWwgPj0gNykge1xuICAgIHJldHVybiAnbWFzdGVyZWQnXG4gIH0gZWxzZSBpZiAodG90YWxSZXZpZXdzID49IDEpIHtcbiAgICByZXR1cm4gJ2xlYXJuaW5nJ1xuICB9XG4gIFxuICByZXR1cm4gJ25ldydcbn1cblxuLy8g5pu05paw55So5oi357uf6K6hXG5mdW5jdGlvbiB1cGRhdGVVc2VyU3RhdHModXNlclByb2dyZXNzOiBhbnksIGlzQ29ycmVjdDogYm9vbGVhbiwgc2Vzc2lvblR5cGU6IHN0cmluZykge1xuICAvLyDmm7TmlrDmgLvlrabkuaDml7bpl7RcbiAgdXNlclByb2dyZXNzLnRvdGFsU3R1ZHlUaW1lICs9IDEgLy8g5q+P5Liq5Y2V6K+NMeWIhumSn1xuICBcbiAgLy8g5pu05paw5a2m5Lmg5aSp5pWw6L+e57ut5oCnXG4gIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKVxuICBpZiAodXNlclByb2dyZXNzLmxhc3RTdHVkeURhdGUgIT09IHRvZGF5KSB7XG4gICAgY29uc3QgeWVzdGVyZGF5ID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvRGF0ZVN0cmluZygpXG4gICAgaWYgKHVzZXJQcm9ncmVzcy5sYXN0U3R1ZHlEYXRlID09PSB5ZXN0ZXJkYXkpIHtcbiAgICAgIHVzZXJQcm9ncmVzcy5zdHJlYWtEYXlzKytcbiAgICB9IGVsc2Uge1xuICAgICAgdXNlclByb2dyZXNzLnN0cmVha0RheXMgPSAxXG4gICAgfVxuICAgIHVzZXJQcm9ncmVzcy5sYXN0U3R1ZHlEYXRlID0gdG9kYXlcbiAgfVxuICBcbiAgLy8g5pu05paw5oC75a2m5Lmg5Y2V6K+N5pWwXG4gIHVzZXJQcm9ncmVzcy50b3RhbFdvcmRzTGVhcm5lZCA9IHVzZXJQcm9ncmVzcy53b3Jkc1Byb2dyZXNzLnNpemVcbiAgXG4gIC8vIOabtOaWsOetiee6p++8iOavjzEwMOS4quWNleivjeWNh+S4gOe6p++8iVxuICB1c2VyUHJvZ3Jlc3MuY3VycmVudExldmVsID0gTWF0aC5mbG9vcih1c2VyUHJvZ3Jlc3MudG90YWxXb3Jkc0xlYXJuZWQgLyAxMDApICsgMVxufVxuXG4vLyDorrDlvZXlrabkuaDkvJror51cbmFzeW5jIGZ1bmN0aW9uIHJlY29yZFN0dWR5U2Vzc2lvbih1c2VySWQ6IHN0cmluZywgc2Vzc2lvbkRhdGE6IGFueSkge1xuICB0cnkge1xuICAgIGdsb2JhbC5zdHVkeVNlc3Npb25zID0gZ2xvYmFsLnN0dWR5U2Vzc2lvbnMgfHwgW11cbiAgICBcbiAgICBjb25zdCBzZXNzaW9uID0ge1xuICAgICAgc2Vzc2lvbklkOiBgc2Vzc2lvbl8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICB1c2VySWQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIC4uLnNlc3Npb25EYXRhXG4gICAgfVxuICAgIFxuICAgIGdsb2JhbC5zdHVkeVNlc3Npb25zLnB1c2goc2Vzc2lvbilcbiAgICBcbiAgICAvLyDlj6rkv53nlZnmnIDov5ExMDAw5p2h5Lya6K+d6K6w5b2VXG4gICAgaWYgKGdsb2JhbC5zdHVkeVNlc3Npb25zLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgIGdsb2JhbC5zdHVkeVNlc3Npb25zID0gZ2xvYmFsLnN0dWR5U2Vzc2lvbnMuc2xpY2UoLTEwMDApXG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+iusOW9leWtpuS5oOS8muivneWksei0pTonLCBlcnJvcilcbiAgfVxufVxuXG4vLyDojrflj5bmnIDov5HmtLvliqhcbmFzeW5jIGZ1bmN0aW9uIGdldFJlY2VudEFjdGl2aXR5KHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBnbG9iYWwuc3R1ZHlTZXNzaW9ucyB8fCBbXVxuICAgIGNvbnN0IHVzZXJTZXNzaW9ucyA9IHNlc3Npb25zXG4gICAgICAuZmlsdGVyKChzZXNzaW9uOiBhbnkpID0+IHNlc3Npb24udXNlcklkID09PSB1c2VySWQpXG4gICAgICAuc2xpY2UoLTEwKSAvLyDmnIDov5ExMOadoeiusOW9lVxuICAgICAgLnJldmVyc2UoKVxuICAgIFxuICAgIHJldHVybiB1c2VyU2Vzc2lvbnNcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfojrflj5bmnIDov5HmtLvliqjlpLHotKU6JywgZXJyb3IpXG4gICAgcmV0dXJuIFtdXG4gIH1cbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiand0IiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwid29yZElkIiwid29yZCIsImlzQ29ycmVjdCIsInF1YWxpdHkiLCJzZXNzaW9uVHlwZSIsInVzZXJJZCIsImdldFVzZXJJZEZyb21Ub2tlbiIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJ1bmRlZmluZWQiLCJ1c2VyUHJvZ3Jlc3MiLCJnZXRVc2VyUHJvZ3Jlc3MiLCJ3b3JkUHJvZ3Jlc3MiLCJ3b3Jkc1Byb2dyZXNzIiwiZ2V0IiwiY3JlYXRlTmV3V29yZFByb2dyZXNzIiwidXBkYXRlZFNNMkRhdGEiLCJjYWxjdWxhdGVTTTIiLCJzbTJEYXRhIiwidG90YWxSZXZpZXdzIiwiY29ycmVjdFJldmlld3MiLCJsYXN0UmV2aWV3RGF0ZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRBdCIsIm1hc3RlcnlMZXZlbCIsImNhbGN1bGF0ZU1hc3RlcnlMZXZlbCIsInNldCIsInVwZGF0ZVVzZXJTdGF0cyIsInJlY29yZFN0dWR5U2Vzc2lvbiIsInN0dWR5VGltZSIsInN1Y2Nlc3MiLCJuZXh0UmV2aWV3RGF0ZSIsImludGVydmFsIiwiYWNjdXJhY3kiLCJNYXRoIiwicm91bmQiLCJ1c2VyU3RhdHMiLCJ0b3RhbFdvcmRzTGVhcm5lZCIsInRvdGFsU3R1ZHlUaW1lIiwic3RyZWFrRGF5cyIsImN1cnJlbnRMZXZlbCIsImVycm9yIiwiY29uc29sZSIsIkdFVCIsInNlYXJjaFBhcmFtcyIsIm5leHRVcmwiLCJ3b3Jkc0FycmF5IiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwiZGFpbHlHb2FsIiwicmVjZW50QWN0aXZpdHkiLCJnZXRSZWNlbnRBY3Rpdml0eSIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwic3RhcnRzV2l0aCIsInRva2VuIiwic3Vic3RyaW5nIiwiZGVjb2RlZCIsInZlcmlmeSIsImdsb2JhbCIsIk1hcCIsImhhcyIsImxhc3RTdHVkeURhdGUiLCJ3ZWVrbHlTdGF0cyIsIm1vbnRobHlTdGF0cyIsIm5vdyIsImVhc2luZXNzRmFjdG9yIiwicmVwZXRpdGlvbnMiLCJjcmVhdGVkQXQiLCJjdXJyZW50U00yIiwidG9kYXkiLCJ0b0RhdGVTdHJpbmciLCJ5ZXN0ZXJkYXkiLCJzaXplIiwiZmxvb3IiLCJzZXNzaW9uRGF0YSIsInN0dWR5U2Vzc2lvbnMiLCJzZXNzaW9uIiwic2Vzc2lvbklkIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0aW1lc3RhbXAiLCJwdXNoIiwibGVuZ3RoIiwic2xpY2UiLCJzZXNzaW9ucyIsInVzZXJTZXNzaW9ucyIsImZpbHRlciIsInJldmVyc2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/progress/save/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fprogress%2Fsave%2Froute&page=%2Fapi%2Fprogress%2Fsave%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fprogress%2Fsave%2Froute.ts&appDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FZhuanz%2FDesktop%2FCache%2Fnext-english-app-sm2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();